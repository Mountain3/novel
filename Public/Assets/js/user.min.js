
if(window.Package==null||window.Package==undefined){window.Package={};}
if(window.Class==null||window.Class==undefined){window.Class={};}
window.Package.create=function(parent,target){var a=target.split(".");if(a.length<1){return null;}
var p=parent;for(var i=0;i<a.length;i++){if(p[a[i]]==null||p[a[i]]==undefined){p[a[i]]={};}
p=p[a[i]];}
return parent[a[0]];};window.Class.getInstance=function(constructor,parent){return(parent!=null?new parent():new(function(){})());};function Listener(){this.listeners=[];}
Listener.prototype.addListener=function(listener){this.listeners[this.listeners.length]=listener;};Listener.prototype.removeListener=function(listener){var listeners=this.listeners;if(listeners!=null){var index=-1;for(var i=0,length=listeners.length;i<length;i++){if(listener==listeners[i]){index=i;break;}}
if(index>-1){for(var i=index,length=listeners.length-1;i<length;i++){listeners[i]=listeners[i+1];}
listeners[listeners.length-1]=null;listeners.length=listeners.length-1;return listener;}}
return null;};Listener.prototype.trigger=function(){var listeners=this.listeners;if(listeners!=null){for(var i=0,length=listeners.length;i<length;i++){var flag=listeners[i].apply(this,arguments);if(flag!=null&&flag!=undefined&&flag==false){break;}}}};window.Timer=function(target,method,interval){this.status=0;this.target=target;this.method=method;this.interval=interval;};Timer.prototype.getTask=function(){if(this.timer==null){var instance=this;this.task=function(){instance.run();};}
return this.task;};Timer.prototype.start=function(interval){if(this.status==0){this.status=1;this.run(interval);}};Timer.prototype.pause=function(interval){var result=this.status;this.status=0;if(this.timer!=null){clearTimeout(this.timer);this.timer=null;}
return result;};Timer.prototype.stop=function(){this.pause();};Timer.prototype.run=function(interval){if(this.timer!=null){clearTimeout(this.timer);this.timer=null;}
if(this.status==1){if(interval!=null){this.timer=setTimeout(this.getTask(),interval);return;}
this.method.call(this.target);if(this.test!=null&&this.test()==false){return;}
this.timer=setTimeout(this.getTask(),this.interval);}};var CookieUtil={};var StringUtil={};CookieUtil.trim=function(s){return(s!=null?s.replace(/(^\s*)|(\s*$)/g,""):"");};CookieUtil.setCookie=function(cookie){var expires="";if(cookie.value==null){cookie.value="";cookie.expires=-1;}
if(cookie.expires!=null){var date=null;if(typeof(cookie.expires)=="number"){date=new Date();date.setTime(date.getTime()+cookie.expires*1000);}else if(cookie.expires.toUTCString!=null){date=cookie.expires;}
expires="; expires="+date.toUTCString();}
var path=cookie.path?"; path="+(cookie.path):"";var domain=cookie.domain?"; domain="+(cookie.domain):"";var secure=cookie.secure?"; secure":"";document.cookie=[cookie.name,"=",(cookie.value!=null?encodeURIComponent(cookie.value):""),expires,path,domain,secure].join("");};CookieUtil.getCookie=function(name){var value=null;if(document.cookie&&document.cookie!=""){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=this.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+"=")){value=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return value;};CookieUtil.getDomain=function(){var a=[""];var b=window.location.host.split(".");var j=(b.length>=3?(b.length-2):0);for(var i=1;j<b.length;j++){a[i++]=b[j];}
return a.join(".");};StringUtil.trim=function(s){return(s!=null?s.toString().replace(/(^\s*)|(\s*$)/g,""):"");};StringUtil.substring=function(source,length,padding){var s=this.trim(source);if(s.length<1){return s;}
var c;var size=0;var count=s.length;var buffer=[];for(var i=0;i<s.length;i++){c=s.charCodeAt(i);if(c>=0x0080){size+=2;count++;}else{size++;}
if(size>length){if(c>=0x4e00){size-=2;}else{size--;}
break;}
buffer.push(s.charAt(i));}
if(size<count&&padding!=null&&padding.length>0){if(buffer.length>0){buffer[buffer.length-1]="";}
buffer.push(padding);}
return buffer.join("");};StringUtil.length=function(source){if(source==null){return 0;}
var c;var s=this.trim(source);var size=s.length;var count=size;for(var i=0;i<count;i++){c=s.charCodeAt(i);if(c>=0x0080){size++;}}
return size;};StringUtil.html=function(source,crlf){if(source==null){return"";}
if(crlf==null){crlf="";}
var c;var buffer=[];for(var i=0,size=source.length;i<size;i++){c=source.charAt(i);switch(c){case'&':{buffer[buffer.length]="&amp;";break;}
case'"':{buffer[buffer.length]="&quot;";break;}
case'<':{buffer[buffer.length]="&lt;";break;}
case'>':{buffer[buffer.length]="&gt;";break;}
case'\r':{if((i+1)<size){if(source.charAt(i+1)=='\n'){buffer[buffer.length]=crlf;i++;}else{buffer[buffer.length]=c;}}else{buffer[buffer.length]=c;}
break;}
case'\n':{buffer[buffer.length]=crlf;break;}
default:{buffer[buffer.length]=c;break;}}}
return buffer.join("");};window.zhBase64=Base64;window.zhCookieUtil=CookieUtil;window.zhStringUtil=StringUtil;var ResourceManager={"resources":{}};ResourceManager.setResource=function(name,value){if(name==null||name==undefined){return null;}
if(value==null||name==value){return null;}
this.resources[name]=value;};ResourceManager.getResource=function(name,defaultValue){var value=this.resources[name];if(value!=null&&value!=undefined){return value;}
return defaultValue;};jQuery.fn.extend({register:function(callback){location.href='https://passport.baidu.com/v2/?reg&color=brown&tpl=zongheng&u='+encodeURIComponent(location.href);},login:function(callback){jQuery.isZhUser="-";document.ondblclick=null;document.onmousedown=null;document.onkeyup=null;var form=jQuery(this);var userName=form.find("input[name=username]");var password=form.find("input[name=passwd]");var randText=form.find("input[name=rand]");var captchaImg=form.find("img.captcha");var loginBtn=form.find("input[name=login]");var msg=form.find("#errorMsg");if(userName.attr("data-autofocus")!="false"){userName.focus().addClass('pass-zhinput-focus');}
randText.val("");if(form.attr("IsSetupEvent")!="true"){form.attr("IsSetupEvent","true");var keydown=function(event){event.stopPropagation();if(event.keyCode==13){loginBtn.click();}};userName.val("");password.val("");randText.val("");userName.unbind();password.unbind();randText.unbind();captchaImg.unbind();loginBtn.unbind();userName.click(function(event){event.stopPropagation();});password.click(function(event){event.stopPropagation();});randText.click(function(event){event.stopPropagation();});captchaImg.click(function(event){event.stopPropagation();});loginBtn.click(function(event){event.stopPropagation();});userName.blur(function(){var value=jQuery(this).val();var oldval=jQuery(this).attr("oldval");if(value!=null&&jQuery.trim(value).length>0&&value!=oldval){jQuery(this).attr("oldval",value);password.val("");jQuery.getScript(Domain.passportHostName+"/checkNativeUser.do?userName="+value,function(){if(jQuery.isZhUser!="Y"){if(form.attr("regBlank")=="true"&&window.confirm("此账号不存在，是否要注册纵横账号？")){window.top.location.href=Domain.passportHostName+"/reg.do?location="+location.href;}}else{jQuery.getScript(Domain.passportHostName+"/checkCaptchaNecessary.do?userName="+value+"&callback=?&r="+Math.random(),function(){if(window.tempCaptchaNecessary){window.tempLogincode=4;form.getCaptcha(false);}});}});}});randText.focus(function(){jQuery(document).keydown(keydown);});randText.blur(function(){jQuery(document).unbind("keydown",keydown);});captchaImg.click(function(){form.getCaptcha(false);});form.find(".captcha_img_btn").click(function(){form.getCaptcha(false);});form.find(".user_register").unbind("click");form.find(".user_register").click(function(){if(jQuery(this).attr("target")=="_blank"){window.open(Domain.passportHostName+"/reg.do?location="+encodeURIComponent(window.location.href));return false;}else{location.href=Domain.passportHostName+"/reg.do?location="+encodeURIComponent(window.location.href);}
return false;});form.find(".forgot").click(function(){location.href=Domain.passportHostName+"/forgotPassword.do?location="+encodeURIComponent(location.href);return false;});}
loginBtn.unbind("click");loginBtn.click(function(){var this_=this;if(userName.val()==""){msg.html("请输入账号");return;}
if(password.val()==""){msg.html("请输入密码");return;}
if(window.tempLogincode&&window.tempLogincode>3&&randText.val()==""){msg.html("请输入验证码");return;}
var loc=form.find("input[name=location]");if(loc.val()==null||jQuery.trim(loc.val()).length<1){loc.val(location.href);}
if(form.attr("async")=="true"){var action=Domain.passportHostName+"/simpleLogin.do";var data={"username":userName.val(),"passwd":password.val(),"rand":randText.val(),"target":"window.returnValue"};var parameters=[];for(var i in data){parameters[parameters.length]=i+"="+encodeURIComponent(data[i]);}
if((action.indexOf("?")>-1)||(action.indexOf("&")>-1)||(action.indexOf("#")>-1)){action=action+"&"+parameters.join("&");}else{action=action+"?"+parameters.join("&");}
jQuery.getScript(action,function(){window.user=UserManager.parse();var returnValue=window.returnValue;if(returnValue==null){returnValue={"code":-1,"message":"登录失败，请重新登录 !"};}
window.tempLogincode=returnValue.code;if(returnValue.code>3){randText.val("");form.getCaptcha(false);msg.html(returnValue.message);return false;}
if(returnValue.code>2){$(this_).attr("disabled",true);setTimeout(function(){$(this_).attr("disabled",false);},2000);return false;}
Dialog.close("login_panel");if(callback!=null){callback(returnValue);}else{UserManager.callback(returnValue);}});}else{form.attr("method","post");form.attr("action",Domain.passportHostName+"/signIn.do");loginBtn.attr("disabled",true);form.submit();}});},getCaptcha:function(check){var form=this;var userName=form.find("input[name=username]");if(userName.val()==null||jQuery.trim(userName.val()).length<1){return false;}
if(check==true){jQuery.getScript(Domain.passportHostName+"/checkNativeUser.do?userName="+userName.val(),function(){if(jQuery.isZhUser!="Y"){if(window.confirm("此账号不存在，是否要注册纵横账号？")){window.top.location.href=Domain.passportHostName+"/reg.do?location="+location.href;}else{userName.focus();}}else{var src=Domain.passportHostName+"/validateImage?r="+(new Date()).getTime();form.find("img.captcha").attr("src",src);form.find("input[name=rand]").val("");form.find("[id^='hidden_captcha_']").show();}});}else{var src=Domain.passportHostName+"/validateImage?r="+(new Date()).getTime();form.find("img.captcha").attr("src",src);form.find("input[name=rand]").val("");form.find("[id^='hidden_captcha_']").show();}
return true;}});if(window.UserManager==null||window.UserManager==undefined){window.UserManager=Class.getInstance(null,Listener);}
UserManager.addListener=function(user){throw new Error("UnsupportOperationException: UserManager.addListener");};UserManager.trigger=function(user){throw new Error("UnsupportOperationException: UserManager.trigger");};UserManager.parse=function(){var cookie=CookieUtil.getCookie("logon");if(cookie!=null&&cookie!=""){var a=cookie.split("|");if(a.length<7){return null;}
var user={};user.userId=zhBase64.decode(a[0]);user.pwUserId=zhBase64.decode(a[1]);user.userName=zhBase64.decode(a[2]);user.nickName=zhBase64.decode(a[3]);user.enable=zhBase64.decode(a[4]);return user;}
return null;};UserManager.getUser=function(){return window.user;};UserManager.callback=function(response){if(response.code==0){location.reload();}else{MessageDialog.open(response.message);}};UserManager.login=function(args){if($.browser.msie&&($.browser.version=="6.0")&&!$.support.style){location.href="http://passport.zongheng.com/login.do?location="+encodeURIComponent(window.location.href);return false;}
args=((args!=null&&args!=undefined)?args:{});var callback=(typeof(args)=="function"?args:args.callback);UserManager.callback=function(response){if(response.code==0){window.user=UserManager.parse();UserInfoManager.load(callback);return false;}else{MessageDialog.open(response.message);return false;}};var a={};if(typeof(args)!="function"){for(var i in args){if(i.toString()!="callback"){a[i]=args[i];}}}
UserManager.buildDialogHtml()
return false;};UserManager.register=function(args){location.href='https://passport.baidu.com/v2/?reg&color=brown&tpl=zongheng&u='+encodeURIComponent(location.href);return false;};UserManager.logout=function(reload,redirect){var bkurl=encodeURIComponent(location.href);if(reload==false){bkurl=redirect;}
window.UserInfoManager.trigger(null);location.href="http://passport.zongheng.com/logout.do?callback="+bkurl+"&rnd="+new Date().getTime();return false;};UserManager.build=function(user){var a=[];if(user!=null&&user!=undefined){var a=[];a[a.length]="<div class=\"right_wrap\">";a[a.length]="    <div class=\"info\">";a[a.length]="        <ul>";a[a.length]="            <li id=\"user_info\" class=\"name\"><a class=\"userImage\" href=\""+Domain.homeHostName+"\" target=\"_blank\"><img src=\"http://static.zongheng.com/userimage/default/image_64_64.gif\"/></a><a class=\"nickName\" href=\""+Domain.homeHostName+"\" title=\""+StringUtil.html(user.nickName)+"\" target=\"_blank\">"+StringUtil.substring(user.nickName,12,"…")+"</a><em class=\"userType vip_1\" style=\"display: none;\" title=\"VIP1级用户\"></em><em class=\"whitesj\"></em><em class=\"ver\"></em></li>";a[a.length]="            <li class=\"mail\"><a id=\"messagestatus\" class=\"maillink\" href=\""+Domain.homeHostName+"/msgSys.do\" target=\"_blank\"><em class=\"ui-message-num\">0</em></a><em class=\"ver\"></em></li>";a[a.length]="            <li class=\"shelf\"><em class=\"book\"></em><a href=\""+Domain.homeHostName+"/favoritesBook.do\" target=\"_blank\">书架</a></li>";a[a.length]="        </ul>";a[a.length]="    </div>";a[a.length]="    <div id=\"user_info_dialog\" class=\"userinfo box\" style=\"display: none;\"></div>";a[a.length]="    <div id=\"mail_detail\" class=\"mail_detail\" style=\"display: none;\"></div>";a[a.length]="</div>";a[a.length]="<div class=\"left_wrap\">";a[a.length]="    <div id=\"read_history\" class=\"history\"></div>";a[a.length]="    <div id=\"historylist\" class=\"historylist box\" id=\"historylist\" style=\"display:none;\"></div>";a[a.length]="</div>";a[a.length]="<div class=\"cl0\"></div>";}else{if($.browser.msie&&($.browser.version=="6.0")&&!$.support.style){a[a.length]='<style>.logonbox .right_wrap_unlogin{float:right;height:34px;padding-right:6px; text-align:right}.logonbox .right_wrap_unlogin div{float:left;padding:0 5px;margin-left:6px}.logonbox .right_wrap_unlogin div a{font-size:14px;font-weight:bold;color:#ebdbba; line-height:35px;}</style><div id="top-user-nav-bar"><div class="right_wrap_unlogin"><div class="login"><a class="user_login" href="###">登录</a></div><div class="regist" style="margin-top:0"><a class="user_register" href="javascript:void(0);">注册</a></div></div></div>';}else{a[a.length]='<style>.logonbox .right_wrap_unlogin{float:right;height:34px;padding-right:6px; text-align:right}.logonbox .right_wrap_unlogin div{float:left;padding:0 5px;margin-left:6px}.logonbox .right_wrap_unlogin div a{font-size:14px;font-weight:bold;color:#ebdbba; line-height:35px;}</style><div id="top-user-nav-bar"><div class="right_wrap_unlogin"><div class="login"><a class="user_login" href="javascript:void(0);">登录</a></div><div class="regist" style="margin-top:0"><a class="user_register" href="javascript:void(0);">注册</a></div></div></div>';}}
return a.join("");};if(window.UserInfoManager==null||window.UserInfoManager==undefined){window.UserInfoManager=Class.getInstance(null,Listener);}
UserInfoManager.bind=function(userInfo){if(userInfo!=null&&userInfo.ret==true){this.userInfo=userInfo;this.trigger(userInfo);}else{UserManager.logout();}};UserInfoManager.load=function(callback){if(window.user!=null&&window.user!=undefined){jQuery.ajax({type:"get",url:Domain.hostName+"/ajax/user.info.do",dataType:"jsonp",async:true,error:function(){},success:function(data){window.UserInfoManager.bind(data);if(callback!=null){callback();}}});}else{window.UserInfoManager.trigger(null);if(callback!=null){callback();}}};UserInfoManager.getUserInfo=function(){return this.userInfo;};UserInfoManager.fixed=function(userInfo){if(userInfo.type==null){userInfo.type=0;}
if(isNaN(parseInt(userInfo.type))){userInfo.type=0;}
if(userInfo.level==null){userInfo.level=1;}
if(isNaN(parseInt(userInfo.level))){userInfo.level=1;}
userInfo.level=parseInt(userInfo.level);if(userInfo.userLevelScore==null||isNaN(userInfo.userLevelScore)){userInfo.userLevelScore=0;}else{userInfo.userLevelScore=parseInt(userInfo.userLevelScore);}
if(userInfo.nextUserLevelScore==null||isNaN(userInfo.nextUserLevelScore)){userInfo.nextUserLevelScore=100;}else{userInfo.nextUserLevelScore=parseInt(userInfo.nextUserLevelScore);}
if(userInfo.userLevelScore<=0){userInfo.userLevelScore=0;}
if(userInfo.nextUserLevelScore<=0){userInfo.nextUserLevelScore=100;}
var percent=(userInfo.userLevelScore/userInfo.nextUserLevelScore);if(isNaN(percent)||percent<0){percent=0.0;}
if(percent>1.0){percent=1.0;}
userInfo.percent=percent;return userInfo;};UserInfoManager.build=function(userInfo){var a=[];if(userInfo!=null){this.fixed(userInfo);a[a.length]="<div class=\"tx_info\"><a class=\"userImage\" href=\""+Domain.homeHostName+"\" target=\"_blank\"><img src=\"http://static.zongheng.com/userimage/default/image_64_64.gif\"/></a></div>";a[a.length]="<div class=\"set\">";a[a.length]="    <div class=\"tc\"><a class=\"setting\" href=\""+Domain.homeHostName+"/setting/userInfo.do\" target=\"_blank\">账号设置</a><a class=\"logout\" href=\"javascript:void(0)\" onclick=\"UserManager.logout();return false;\">退出</a></div>";a[a.length]="    <p>"+UserInfoManager.getUserLevelIcons(userInfo.level)+"</p>";a[a.length]="    <p>";if(userInfo.type>0){a[a.length]="<em class=\"vip_"+userInfo.type+"\" title=\"VIP"+userInfo.type+"级用户\"></em>";}
a[a.length]="<a href=\""+Domain.bookHostName+"/member/privilege.html\" target=\"_blank\">查看我的VIP特权&gt;&gt;</a>";a[a.length]="    </p>";a[a.length]="</div>";a[a.length]="<div class=\"cl15\"></div>";a[a.length]="<div class=\"piao\">";a[a.length]="    <p>推荐票：<em class=\"voteNum\">"+userInfo.recomment+"</em>张<a href=\""+Domain.hostName+"/help/zh93.html\" target=\"_blank\"><span class=\"tj_ticket\"></span></a></p>";a[a.length]="    <p>纵横币：<em>"+userInfo.money+"</em><span class=\"zh_money\"></span><a href=\"http://pay.zongheng.com\" target=\"_blank\">[充值]</a></p>";a[a.length]="    <p class=\"last\">月票：<em id=\"userMonthTicket\">正在更新...</em>张<a href=\""+Domain.hostName+"/help/zh93.html#q1\" target=\"_blank\"><span class=\"tj_ticket\"></span></a></p>";a[a.length]="</div>";}
return a.join("");};UserInfoManager.getUserLevelIcons=function(level,title){var icons=[];if(level!=null){level=parseInt(level);if(isNaN(level)==false&&level>0){level=(level<=21?level:21);var sun=Math.floor(level/16);var moon=Math.floor((level-sun*16)/4);var star=(level-sun*16-moon*4);if(title!=null&&title!=undefined){icons[icons.length]="<span class=\"leval\" title=\"用户等级："+level+"级&nbsp;（"+title+"）\">";}else{icons[icons.length]="<span class=\"leval\" title=\"用户等级："+level+"级\">";}
for(var i=0;i<sun;i++){icons[icons.length]="<span class=\"level_sun\"></span>";}
for(var i=0;i<moon;i++){icons[icons.length]="<span class=\"level_moon\"></span>";}
for(var i=0;i<star;i++){icons[icons.length]="<span class=\"level_star\"></span>";}
icons[icons.length]="</span>";}}
return icons.join("");};UserInfoManager.getUserInfo=function(){return this.userInfo;};UserInfoManager.serialize=function(json){var a=[];if(json!=null){if(typeof(json)=="object"){for(var name in json){var value=json[name];var className=typeof(value);if(value!=null){if(className=="object"&&value.length!=null){for(var j=0;j<value.length;j++){if(value[j]!=null){a[a.length]=encodeURIComponent(name)+"="+encodeURIComponent(value[j]);}}}else{a[a.length]=encodeURIComponent(name)+"="+encodeURIComponent(value.toString());}}}}}
return a.join("&");};UserInfoManager.getReadHistoryHtml=function(list){if(list.length>0){var a=[];var e=list[0];a[a.length]="<div class=\"cur\">";a[a.length]="    <span><em>&nbsp;</em></span>";a[a.length]="    <a href=\""+Domain.bookHostName+"/book/"+e.bookId+".html\" target=\"_blank\">"+StringUtil.substring(e.bookName,14,"…")+"</a>";a[a.length]="</div>";a[a.length]="<div class=\"record\"><em>|</em>历史记录<i></i></div>";return a.join("");}
return"";};UserInfoManager.getReadHistoryListHtml=function(list){if(list.length>0){var b=[];var e=list[0];b[b.length]="<div class=\"cl5\"></div>";b[b.length]="<div class=\"wz\">";b[b.length]="<p class=\"cur\"><span><em>[更新]</em>"+e.readedStr+"</span><a href=\""+Domain.bookHostName+"/book/"+e.bookId+".html\" target=\"_blank\">"+StringUtil.substring(e.bookName,14,"…")+"</a></p>";if(e.nextChapterId!=0){b[b.length]="<p><a href=\""+Domain.bookHostName+"/chapter/"+e.bookId+"/"+e.chapterId+".html\" target=\"_blank\">"+e.chapterName+"</a></p>";if(e.nextChapterId!=e.chapterId){b[b.length]="<p><em>是否要看</em><a href=\""+Domain.bookHostName+"/chapter/"+e.bookId+"/"+e.nextChapterId+".html\" target=\"_blank\">"+StringUtil.substring(e.nextChapterName,26,"...")+"</a></p>";}else{b[b.length]="<p><em>是否要看</em>提示：已看到最后一章</p>";}}
b[b.length]="<ul>";for(var i=1;i<list.length;i++){e=list[i];b[b.length]="<li><span>"+e.readedStr+"</span><a href=\""+Domain.bookHostName+"/book/"+e.bookId+".html\" target=\"_blank\">"+e.bookName+"</a></li>";}
b[b.length]="</ul>";b[b.length]="<p class=\"tc\">查看更多<a href=\""+Domain.homeHostName+"/myBookReaded.do\" target=\"_blank\">历史记录</a></p>";b[b.length]="</div>";b[b.length]="<div class=\"cl\"></div>";return b.join("");}
return"";};UserInfoManager.setMessageNumber=function(num){var e=jQuery("#messagestatus .ui-message-num");if(e.size()>0){var n=parseInt(e.attr("messageNumber"));if(isNaN(n)||n<0){n=0;}
num=parseInt(num);if(isNaN(num)||num<0){num=0;}
n=n+num;e.attr("messageNumber",n);e.html((n>99?99:n));if(n>0){jQuery("#messagestatus").addClass("active");}}};UserManager.crossPass=function(ret){$.ajax({url:'http://zongheng.baidu.com/getbduss.do',type:'GET',dataType:'jsonp',data:{ret:ret},success:function(data){if(data.errCode==0){window.user=UserManager.parse();UserInfoManager.load();Dialog.close("login_panel");if(data.token==0||data.token==-1){var newUsrHtml='<div class="sign_done_box" id="newBDPUsr"><div class="tit"><span class="zh_logo"></span><em class="close" onclick="Dialog.close(\'newBDPUsr\')">关闭</em></div><div class="con"><p align="center">Hi,'+user.nickName+'，您已经成功注册纵横账号。</p><div class="tr"><a href="javascript:void(0);" id="oldUsrLogin" class="login">我是纵横老用户，登录<b>&gt;&gt;</b></a></div><div class="recommend"><h3>大家都在看</h3><em class="icon"></em><div></div><ul class="book_box" id="uewUsrtBook"></ul></div><div><a class="btn" href="javascript:void(0);" id="newUsrAdf">一键收藏</a></div></div></div>';$("body").append(newUsrHtml);$("#oldUsrLogin").click(function(){Dialog.close("newBDPUsr");UserManager.login();_hmt.push(['_trackEvent',"newGuide","oldLogin"]);});$("#newUsrAdf").click(function(){if($(this).attr("added"==1))return false
var sucCount={num:0,code:0};for(var i=0;i<4;i++){$.ajax({type:"get",url:"/ajax/bookshelf.do",data:{bookId:$("#uewUsrtBook li:eq("+i+")").attr("bookId"),rnd:new Date().getTime()},async:true,dataType:"json",error:function(){$("#newUsrAdf").attr("added",0)},timeout:10000,success:function(data){sucCount.code++
if(data.code==0){sucCount.num++}else{sucCount.num--
if(sucCount.num<0)sucCount.num=0}
if(sucCount.code==4){if(sucCount.num==4){MessageDialog.open("已全部添加",function(){Dialog.close("newBDPUsr");})}else{MessageDialog.open("成功添加"+sucCount.num+"本",function(){Dialog.close("newBDPUsr");})}}
$("#newUsrAdf").attr("added",1)}});}
_hmt.push(['_trackEvent',"newGuide","addAllfav"]);});$.ajax({type:"get",url:"/ajax/rank.getZongHengMonthTicketRankList.do",data:{rankType:1,pageNum:1,pageSize:10},async:true,dataType:"json",error:function(){return;},timeout:10000,success:function(data){if(data==null||data.length==null){return;}
var buffer=[];for(var i=0;i<5;i++){var key=Math.floor(Math.random()*data.length);var e=data[key];if(e.bookId!=$("body").attr("bookId")&&e!=0){buffer[buffer.length]="<li bookId="+e.bookId+"><a href=\""+Domain.bookHostName+"/book/"+e.bookId+".html?from=newbieguide\" title=\""+StringUtil.html(e.bookName)+"\" target=\"_blank\" onclick=\"_hmt.push(['_trackEvent', 'newGuide', 'bookClick_"+parseInt(i+1)+"','"+e.bookId+"']);\"><img src=\"http://static.zongheng.com/upload/"+e.cover+"\" width=\"104\" height=\"139\"></a></li>";data.splice(key,1);}}
$("#uewUsrtBook").html(buffer.join(""));}});Dialog.open("newBDPUsr");}}else{UserInfoManager.trigger(null);}}});}
UserManager.buildDialogHtml=function(){if($("#login_panel").length>0){Dialog.open("login_panel");return false;}
var dialogHtml='<div id="login_panel" class="log_reg_box updiv"><div class="tit"><div id="udlg_tab"><span class="current" tabId="1">纵横账号登录</span> | <span tabId="2" statId="regtab">百度账号登录</span></div><em class="close">关闭</em></div><div class="con"><div class="tab_log_reg tabpanel" tabId="1">'
dialogHtml+='<form name="login_form" method="post" async="true"><div class="login_box tang-pass-login"><div id="errorMsg"></div><p class="pass-form-item pass-form-item-userName"><label for="TANGRAM_zh_userName" class="pass-label pass-label-userName">纵横账号</label><input type="text" name="username" class="pass-text-input pass-text-input-userName" autocomplete="off" placeholder="纵横账号"></p><p class="pass-form-item pass-form-item-password"><label for="TANGRAM_zh_password" class="pass-label pass-label-password">密 码</label><input type="password" name="passwd" class="pass-text-input pass-text-input-password" placeholder="密 码"></p><p id="hidden_captcha_0" class="pass-form-item pass-form-item-verifyCode yzm" style="display: none; visibility: visible; opacity: 1;"><label for="TANGRAM_zh_verifyCode" class="pass-label pass-label-verifyCode">验证码</label><input id="TANGRAM_zh_verifyCode" type="text" name="rand" class="pass-text-input pass-text-input-verifyCode" maxlength="6" placeholder="验证码"><span class="pass-verifyCodeImgParent"><img class="pass-verifyCode validate captcha" src="other/validateImage?r="></span><a class="pass-change-verifyCode captcha_img_btn" href="javascript:void(0);">&nbsp;看不清楚？</a></p><p class="pass-form-item pass-form-item-submit"><input name="login" type="button" value="登录" class="pass-button pass-button-submit enter" style="background:#900c1c"><a class="pass-reglink" href="https://passport.baidu.com/v2/?reg&color=brown&tpl=zongheng&u='+encodeURIComponent(location.href)+'" target="_blank">立即注册</a><a class="pass-fgtpwd forgot" href="javascript:void(0);">忘记密码？</a></p>'
dialogHtml+='<div class="tang-pass-login-phoenix" style="margin:0"><div class="pass-phoenix-title">可以使用以下方式登录<span class="pass-phoenix-note"></span></div><div class="pass-phoenix-list clearfix"><div class="pass-phoenix-btn clearfix"><ul class="bd-acc-list other_login" style="position:relative"><li class="bd-acc-qzone" ><a class="phoenix-btn-item js_qq_login" href="javascript:void(0);" title="QQ帐号">QQ帐号</a></li><li style="width:334px;height:29px;background:url(http://static.zongheng.com/v2014/images/bdpass/qqalert.png);position:absolute;float:left;margin-top:-2px;left:20px"></li></ul></div></div><div class="clear"></div></div>';dialogHtml+='</div></form></div><div class="tab_log_reg tabpanel" tabId="2" style="display:none"><div class="baidupassinner"><div id="zongheng_pass_wap"></div></div><div class="cl0"></div></div></div></div>';$("body").append(dialogHtml);Dialog.open("login_panel");var source=jQuery("#login_panel");var form1=jQuery("#login_panel").find("form[name=login_form]");form1.login(UserManager.callback);form1.find(".pass-text-input").focus(function(){$(this).addClass('pass-zhinput-focus');});form1.find(".pass-text-input").blur(function(){$(this).removeClass('pass-zhinput-focus');});form1.find(".user_register").unbind();form1.find(".forgot").unbind().attr("href",Domain.passportHostName+"/forgotPassword.do");form1.find(".other_login a.js_qq_login").click(function(){var handler=function(){var qqLoginUrl="http://openapi.qzone.qq.com/oauth/show?which=Login&response_type=code&client_id=100300893&redirect_uri="+encodeURIComponent("http://passport.zongheng.com/qqLogin.do?"+location.href)+"&scope=get_user_info,list_album,upload_pic";location.href=qqLoginUrl;return false;};window.top.eval("("+handler.toString()+")()");});jQuery(".dlg_register").click(function(){window.open("https://passport.baidu.com/v2/?reg&color=brown&tpl=zongheng&u="+encodeURIComponent(window.location.href));return false;});var loadNickName=false;source.find(".close").click(function(){Dialog.close("login_panel");});source.find("#udlg_tab span").click(function(){var tabId=jQuery(this).attr("tabId");if(tabId=="1"){location.href=Domain.passportHostName+"/?logintype=zh&location="+encodeURIComponent(window.location.href);return false;}
if(tabId!=null){CookieUtil.setCookie({name:"lgpType",value:tabId,expires:31104000,path:"/",domain:".zongheng.com"});jQuery(this).siblings().removeClass("current");jQuery(this).addClass("current");var e=jQuery(this).closest(".tit").siblings("div.con");e.find("div.tabpanel").hide();e.find("div.tabpanel[tabId="+tabId+"]").show();Dialog.setSize(source.width(),source.height());Dialog.center("login_panel");}});var lgpt=CookieUtil.getCookie("lgpType");$("#udlg_tab span[tabId=2]").click();$.getScript("http://passport.baidu.com/passApi/js/wrapper.js?cdnversion="+new Date().getTime(),function(){passport.use('login',{tangram:true},function(magic){var loginInstance=new magic.passport.login({product:"zongheng",staticPage:location.protocol+'//'+location.hostname+'/v3Jump.html',u:location.href,charset:'utf-8',memberPass:true,hasRegUrl:true,loginType:2,defaultCss:false,loginMerge:true,autosuggest:true,hasPlaceholder:true,authsiteLogin:['qzone','tsina'],registerLink:'https://passport.baidu.com/v2/?reg&color=brown&tpl=zongheng&u='+encodeURIComponent(location.href),authsiteCfgLogin:{act:"implicit",jumpUrl:location.protocol+'//'+location.hostname+'/xd.html',onBindSuccess:function(a,b){UserManager.crossPass(1)
return false;}},sms:true,isPhone:false,safeFlag:0});loginInstance.on('loginError',function(args){if(args.rsp.errInfo.no==18){Dialog.close("login_panel");}});loginInstance.on('loginSuccess',function(args){args.returnValue=false;UserManager.crossPass(1);});loginInstance.render('zongheng_pass_wap');});});}
UserManager.hideMessageNumber=function(){var userId=0;if(window.user!=null){userId=window.user.userId;}
CookieUtil.setCookie({name:"userMessage_"+userId,value:"1",expires:3*60,path:"/",domain:".zongheng.com"});jQuery("#messagestatus").parent().unbind("mouseover");jQuery("#messagestatus").removeClass("active");};UserManager.iknown=function(id,key){jQuery("#"+id+" .iknown").click(function(){CookieUtil.setCookie({name:key,value:"true",expires:365*24*60*60,path:"/",domain:".zongheng.com"});jQuery("#"+id).fadeOut();});var known=CookieUtil.getCookie(key);if(known!="true"){jQuery("#"+id).show();if(jQuery("#"+id).attr("autohide")!="false"){setTimeout(function(){jQuery("#"+id+" .iknown").click();},15*1000);}
return;}};(function(){var backUrl=CookieUtil.getCookie("zh_back_url");if(backUrl!=null&&backUrl.length>0){CookieUtil.setCookie({name:"zh_back_url",value:null,expires:-1,path:"/",domain:".zongheng.com"});location.href=backUrl;return;}
window.user=UserManager.parse();if(window.user==null||window.user==undefined){window.user=null;}})();jQuery(function(){jQuery(".homepage").click(function(){if(jQuery.browser.msie){document.body.style.behavior="url(#default#homepage)";document.body.setHomePage(location.href);}else if(jQuery.browser.mozilla){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");return;}catch(e){MessageDialog.open("此操作被浏览器拒绝！\n请在浏览器地址栏输入“about:config”并回车\n然后将[signed.applets.codebase_principal_support]设置为'true'");return;}
try{var prefs=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);prefs.setCharPref("browser.startup.homepage",location.href);return;}catch(e){}
MessageDialog.open("您的浏览器不支持此操作, 请使用浏览器设置功能进行添加 !");}
return false;});jQuery(".homemark").click(function(){var title="纵横中文网";var address=Domain.hostName;if(window.sidebar!=null){try{if(window.sidebar.addPanel!=null){window.sidebar.addPanel(title,address,"");return;}}catch(e){}
MessageDialog.open("请按Ctrl+D键收藏 !");return;}
if(window.external!=null){try{window.external.addFavorite(address,title);return;}catch(e){}
try{window.external.addToFavoritesBar(address,title,"slice");return;}catch(e){}}
MessageDialog.open("您的浏览器不支持此操作, 请使用浏览器的收藏夹进行添加 !");return false;});});jQuery(function(){if(window.user!=null){UserInfoManager.load();}else{UserManager.crossPass(0);}});jQuery(function(){jQuery("form.user-login").each(function(){jQuery(this).login(UserManager.callback);});jQuery("form.user-register").each(function(){jQuery(this).register();});jQuery(".user_login").unbind("click").click(function(){location.href=Domain.passportHostName+"/?location="+encodeURIComponent(window.location.href);});jQuery(".user_register").unbind("click").click(function(){if(jQuery(this).attr("target")=="_blank"){window.open("https://passport.baidu.com/v2/?reg&color=brown&tpl=zongheng&u="+encodeURIComponent(window.location.href));}else{location.href="https://passport.baidu.com/v2/?reg&color=brown&tpl=zongheng&u="+encodeURIComponent(window.location.href);}
return false;});jQuery(".forgot").click(function(){if(jQuery(this).attr("target")=="_blank"){window.open(Domain.passportHostName+"/forgotPassword.do?location="+encodeURIComponent(window.location.href));}else{location.href=Domain.passportHostName+"/forgotPassword.do?location="+encodeURIComponent(window.location.href);}
return false;});jQuery(".logout").click(function(){UserManager.logout();return false;});});jQuery(function(){jQuery("#ui_top_search_button").hover(function(){jQuery(this).addClass("hover");jQuery("#ui_top_search_dialog").show();},function(){jQuery(this).removeClass("hover");jQuery("#ui_top_search_dialog").hide();});jQuery("#ui_top_search_dialog").hover(function(){jQuery("#ui_top_search_button").addClass("hover");jQuery(this).show();},function(){jQuery("#ui_top_search_button").removeClass("hover");jQuery(this).hide();});var parent=jQuery("#ui_top_search_dialog");parent.find("input.sousuo").click(function(){var keyword=parent.find("input[name=keyword]").val().replace(/(^\s*)|(\s*$)/g,"");if(keyword!="书名/作者/标签"&&keyword!=""){if(location.host=="search.zongheng.com"){location.href="http://search.zongheng.com/search/all/"+encodeURI(keyword)+"/1.html";}else{window.open("http://search.zongheng.com/search/all/"+encodeURI(keyword)+"/1.html","_blank");}}
return false;});parent.find("input[name=keyword]").change(function(){if(this.value.replace(/(^\s*)|(\s*$)/g,"")==""){this.value=this.getAttribute("defaultDataValue");}
return false;});parent.find("input[name=keyword]").keydown(function(event){event=(event||window.event);if(event.keyCode==13){parent.find("input.sousuo").click();return false;}
return true;});parent.find("input[name=keyword]").focus(function(event){if(this.value==this.getAttribute("defaultDataValue")){this.value="";}});parent.find("input[name=keyword]").blur(function(event){if(this.value.replace(/(^\s*)|(\s*$)/g,"")==""){this.value=this.getAttribute("defaultDataValue");}});jQuery("#ui_top_nav_button").hover(function(){jQuery(this).addClass("mail_hover");jQuery("#ui_top_nav_dialog").show();},function(){jQuery(this).removeClass("mail_hover");jQuery("#ui_top_nav_dialog").hide();});jQuery("#ui_top_nav_dialog").hover(function(){jQuery("#ui_top_nav_button").addClass("mail_hover");jQuery(this).show();},function(){jQuery("#ui_top_nav_button").removeClass("mail_hover");jQuery(this).hide();});});UserInfoManager.addListener(function(userInfo){if(userInfo!=null){jQuery("#top-user-nav-bar").attr("class","load");jQuery("#top-user-nav-bar").html(UserManager.build(window.user));if(userInfo.type>0){jQuery("#user_info .userType").attr("class","userType vip_"+userInfo.type);jQuery("#user_info .userType").attr("title","VIP"+userInfo.type+"级用户");jQuery("#user_info .userType").show();}}else{jQuery("#top-user-nav-bar").attr("class","unload");jQuery("#top-user-nav-bar").html(UserManager.build(window.user));}});UserInfoManager.addListener(function(userInfo){if(userInfo==null){return;}
jQuery("#user_info_dialog").html(UserInfoManager.build(userInfo));jQuery("#user_info a.userImage img").attr("src",userInfo.image);jQuery("#user_info_dialog a.userImage img").attr("src",userInfo.image);jQuery("#user_info").hover(function(){jQuery(this).addClass("menu_hover");jQuery("#user_info_dialog").show();if(jQuery("#userMonthTicket").attr("data-loaded")!="1"){jQuery("#userMonthTicket").attr("data-loaded","1");jQuery.ajax({type:"get",url:"http://www.zongheng.com/ajax/user.getMemberTicket.do",dataType:"jsonp",error:function(){},success:function(data){if(data.code=="0"&&data.memberTicket!=null){var memberTicket=parseInt(data.memberTicket);var voteMemberTicket=parseInt(data.voteMemberTicket);if(isNaN(memberTicket)==false){var userInfo=UserInfoManager.getUserInfo();userInfo.memberTicket=memberTicket;userInfo.voteMemberTicket=voteMemberTicket;jQuery("#userMonthTicket").html(memberTicket);}}}});}},function(){jQuery(this).removeClass("menu_hover");jQuery("#user_info_dialog").hide();});jQuery("#user_info_dialog").hover(function(){jQuery("#user_info").addClass("menu_hover");jQuery(this).show();},function(){jQuery("#user_info").removeClass("menu_hover");jQuery(this).hide();});});UserInfoManager.addListener(function(userInfo){if(userInfo==null||userInfo==undefined){return;}
var userMessageStatus=CookieUtil.getCookie("userMessage_"+window.user.userId);if(userMessageStatus=="1"){return;}
var a=[];a[a.length]="<div class=\"title\">";a[a.length]="    <span class=\"closemail\" onclick=\"jQuery('#mail_detail').hide();\"></span>";a[a.length]="</div>";a[a.length]="<div id=\"userMessageList\" class=\"con\">";a[a.length]="    <p><a class=\"userMessageButton\" href=\""+Domain.homeHostName+"/msgIn.do\" target=\"_blank\">查看</a>有<em id=\"usermessage\">("+userInfo.message+")</em>条未读站内信息</p>";a[a.length]="</div>";jQuery("#mail_detail").html(a.join(""));jQuery("#messagestatus").parent().hover(function(){jQuery("#messagestatus").parent().addClass("mail_hover");jQuery("#mail_detail").show();},function(){jQuery("#messagestatus").parent().removeClass("mail_hover");jQuery("#mail_detail").hide();});jQuery("#mail_detail").hover(function(){jQuery("#messagestatus").parent().addClass("mail_hover");jQuery(this).show();},function(){jQuery("#messagestatus").parent().removeClass("mail_hover");jQuery(this).hide();});if(userInfo.message!=null&&userInfo.message>0){UserInfoManager.setMessageNumber(userInfo.message);jQuery("#usermessage").html("("+userInfo.message+")");jQuery("#messagestatus").click(function(){UserManager.hideMessageNumber();});jQuery("#userMessageList .userMessageButton").click(function(){UserManager.hideMessageNumber();});}
jQuery.ajax({type:"get",url:Domain.homeHostName+"/show/ajax/inviteNum.do?userId="+window.user.userId,dataType:"jsonp",async:true,error:function(){},success:function(data){if(data!=null&&data.count!=null){var num=parseInt(data.count);if(isNaN(num)){num=0;}
if(num>0){jQuery("#userMessageList").append("<p><a class=\"moderatorMessageButton\" href=\""+Domain.homeHostName+"/msgInvite.do\" target=\"_blank\">查看</a>有<em id=\"moderatorMessage\">("+num+")</em>条副版主邀请</p>");jQuery("#messagestatus").addClass("active");jQuery("#userMessageList .moderatorMessageButton").click(function(){UserManager.hideMessage();});}}}});});jQuery(function(){jQuery(".logonbox").dblclick(function(event){var src=(event.srcElement||event.target);if(src==null){return true;}
var nodeName=src.nodeName.toLowerCase();if(nodeName=="a"||nodeName=="input"||nodeName=="select"){return true;}
jQuery("#top_bar_close").click();return false;});jQuery("#top_bar_close").click(function(){var source=jQuery(this);if(source.hasClass("open")){jQuery("#topnavbar").show();source.html("关闭");source.removeClass("open").show();jQuery(".zonghengbg").css("padding-top","37px");jQuery(".newlink").show();if(jQuery("#ui_wrap1").size()>0){jQuery("#ui_wrap1").css("margin-top","0px");}
if(jQuery("#uiDirectoryButton").size()>0){jQuery("#uiDirectoryButton").css("top",jQuery("#uiViewPanel").position().top+"px");}
document.cookie="zh_topnavbar=false;path=/;domain=.zongheng.com";}else{jQuery("#topnavbar").hide();source.html("打开");source.addClass("open").show();jQuery(".zonghengbg").css("padding","0px");jQuery(".newlink").hide();if(jQuery("#ui_wrap1").size()>0){jQuery("#ui_wrap1").css("margin-top","-37px");}
if(jQuery("#uiDirectoryButton").size()>0){jQuery("#uiDirectoryButton").css("top",jQuery("#uiViewPanel").position().top+"px");}
document.cookie="zh_topnavbar=true;path=/;domain=.zongheng.com";}
return false;});var zhTopNavBar=CookieUtil.getCookie("zh_topnavbar");if(zhTopNavBar=="true"){jQuery("#top_bar_close").click();}});